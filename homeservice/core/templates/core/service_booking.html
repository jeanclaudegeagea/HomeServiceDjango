<!-- templates/core/service_booking.html -->
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h1 class="text-2xl font-bold mb-4">Book Service: {{ service.name }}</h1>
        
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Service Details -->
            <div class="md:w-1/2">
                <h2 class="text-xl font-semibold mb-2">Service Details</h2>
                <p class="text-gray-700 mb-4">{{ service.description }}</p>
                <p class="text-lg font-bold text-indigo-600">${{ service.price }}</p>
                
                <div class="mt-6">
                    <h2 class="text-xl font-semibold mb-2">Provider Details</h2>
                    <div class="flex items-center space-x-4">
                        {% if provider.user.profile_image %}
                        <img class="h-12 w-12 rounded-full object-cover" src="{{ provider.user.profile_image.url }}" alt="">
                        {% else %}
                        <div class="h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-medium">
                            {{ provider.user.first_name|first|upper }}{{ provider.user.last_name|first|upper }}
                        </div>
                        {% endif %}
                        <div>
                            <h3 class="font-medium text-gray-900">{{ provider.user.get_full_name }}</h3>
                            <p class="text-sm text-gray-500">{{ service.specialization.name }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Booking Form -->
            <div class="md:w-1/2">
                <form method="post" class="space-y-4">
                    {% csrf_token %}
                
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Select Day</label>
                        <select name="day" id="day-select" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Select a day</option>
                            {% for day in weekly_schedule %}
                            <option value="{{ day.day }}">{{ day.get_day_display }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Available Times</label>
                        <div id="time-slots-container" class="grid grid-cols-3 gap-2">
                            <!-- Time slots will be loaded here via JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                        <textarea name="notes" id="notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-black text-white py-2 px-4 rounded-md hover:bg-gray-200 hover:text-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Request Booking
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const daySelect = document.getElementById('day-select');
        const timeSlotsContainer = document.getElementById('time-slots-container');
        
        // Store time slots data
        const timeSlotsData = {
            {% for day in weekly_schedule %}
            '{{ day.day }}': {{ day.time_slots|safe }},
            {% endfor %}
        };
        
        daySelect.addEventListener('change', function() {
            const selectedDay = this.value;
            timeSlotsContainer.innerHTML = '';
            
            if (selectedDay && timeSlotsData[selectedDay]) {
                timeSlotsData[selectedDay].forEach(function(time) {
                    const timeSlot = document.createElement('button');
                    timeSlot.type = 'button';
                    timeSlot.className = 'time-slot-btn py-2 px-3 border border-gray-300 rounded-md text-center hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-indigo-500';
                    timeSlot.textContent = time;
                    timeSlot.dataset.time = time;
                    
                    timeSlot.addEventListener('click', function() {
                        // Remove active class from all buttons
                        document.querySelectorAll('.time-slot-btn').forEach(function(btn) {
                            btn.classList.remove('bg-indigo-600', 'text-white');
                            btn.classList.add('border-gray-300');
                        });
                        
                        // Add active class to clicked button
                        this.classList.add('bg-indigo-600', 'text-white');
                        this.classList.remove('border-gray-300');
                        
                        // Create hidden input for selected time
                        let timeInput = document.querySelector('input[name="time"]');
                        if (!timeInput) {
                            timeInput = document.createElement('input');
                            timeInput.type = 'hidden';
                            timeInput.name = 'time';
                            this.parentNode.appendChild(timeInput);
                        }
                        timeInput.value = this.dataset.time;
                    });
                    
                    timeSlotsContainer.appendChild(timeSlot);
                });
            }
        });
    });
    </script>
{% endblock %}